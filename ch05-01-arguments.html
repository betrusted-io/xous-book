<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Arguments Structure - The Xous Operating System</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="title-page.html">The Xous Operating System</a></li><li class="chapter-item expanded affix "><a href="ch00-00-introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="ch01-00-getting-started.html"><strong aria-hidden="true">1.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch01-02-hello-world.html"><strong aria-hidden="true">1.1.</strong> Hello, World!</a></li><li class="chapter-item expanded "><a href="ch01-03-hello-renode.html"><strong aria-hidden="true">1.2.</strong> Hello, Renode!</a></li></ol></li><li class="chapter-item expanded "><a href="ch02-00-server-architecture.html"><strong aria-hidden="true">2.</strong> Server Architecture</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch02-04-synchronization.html"><strong aria-hidden="true">2.1.</strong> Synchronization</a></li></ol></li><li class="chapter-item expanded "><a href="ch03-00-introducing-the-kernel.html"><strong aria-hidden="true">3.</strong> Introducing the Kernel</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch03-01-memory-layout.html"><strong aria-hidden="true">3.1.</strong> Memory Layout</a></li><li class="chapter-item expanded "><a href="ch03-02-hosted-mode.html"><strong aria-hidden="true">3.2.</strong> Hosted Mode</a></li></ol></li><li class="chapter-item expanded "><a href="ch04-00-renode-emulation.html"><strong aria-hidden="true">4.</strong> Renode Emulation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch04-01-platform-definition.html"><strong aria-hidden="true">4.1.</strong> Platform Definition</a></li><li class="chapter-item expanded "><a href="ch04-02-renode-startup-script.html"><strong aria-hidden="true">4.2.</strong> Renode Startup Script</a></li><li class="chapter-item expanded "><a href="ch04-03-python-extensions.html"><strong aria-hidden="true">4.3.</strong> Python Extensions</a></li><li class="chapter-item expanded "><a href="ch04-04-writing-cs-peripherals.html"><strong aria-hidden="true">4.4.</strong> Writing C# Peripherals</a></li></ol></li><li class="chapter-item expanded "><a href="ch05-00-system-startup.html"><strong aria-hidden="true">5.</strong> System Startup</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch05-01-arguments.html" class="active"><strong aria-hidden="true">5.1.</strong> Arguments Structure</a></li><li class="chapter-item expanded "><a href="ch05-02-loader.html"><strong aria-hidden="true">5.2.</strong> Xous Loader</a></li><li class="chapter-item expanded "><a href="ch05-03-minielf.html"><strong aria-hidden="true">5.3.</strong> MiniELF Format</a></li></ol></li><li class="chapter-item expanded "><a href="ch06-00-build-system-overview.html"><strong aria-hidden="true">6.</strong> Build System</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch06-02-create-image.html"><strong aria-hidden="true">6.1.</strong> Image Creation</a></li></ol></li><li class="chapter-item expanded "><a href="ch07-00-messages.html"><strong aria-hidden="true">7.</strong> Messages</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch07-01-xous-names.html"><strong aria-hidden="true">7.1.</strong> Xous Names</a></li><li class="chapter-item expanded "><a href="ch07-02-caller-idioms.html"><strong aria-hidden="true">7.2.</strong> Caller Idioms</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch07-03-nonsynchronizing.html"><strong aria-hidden="true">7.2.1.</strong> Non-synchronizing</a></li><li class="chapter-item expanded "><a href="ch07-04-synchronizing.html"><strong aria-hidden="true">7.2.2.</strong> Synchronous</a></li><li class="chapter-item expanded "><a href="ch07-05-asynchronous.html"><strong aria-hidden="true">7.2.3.</strong> Asynchronous</a></li><li class="chapter-item expanded "><a href="ch07-06-deferred.html"><strong aria-hidden="true">7.2.4.</strong> Deferred Response</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="ch08-00-graphics.html"><strong aria-hidden="true">8.</strong> Graphics Toolkit</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch08-01-modals.html"><strong aria-hidden="true">8.1.</strong> Modals</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">The Xous Operating System</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        <a href="https://github.com/betrusted-io/xous-book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#system-arguments" id="system-arguments">System Arguments</a></h1>
<p>The loader and kernel use a tagged format for defining system arguments. This tagged structure is designed to be small, and only describes data. The structure does not include any executable data. Instead, it contains references to this data that may be located immediately after the structure on a storage medium.</p>
<p>The tagged structure defines a prefix that is tagged by an 8-byte structure:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Tag {
    /// Ascii-printable name, not null-terminated, in little endian format.
    tag: u32,

    /// CRC16 of the data section, using CCITT polynomial.
    crc16: u16,

    /// Size of the data section, in 4-byte words.
    size: u16,
}
<span class="boring">}
</span></code></pre></pre>
<p>Tags are stored sequentially on disk, meaning a reader can skip over tags that it does not recognize. Furthermore, it can use a combination of <code>crc16</code> and <code>size</code> to determine that it has found a valid section.</p>
<p>The <code>size</code> field is in units of 4-bytes. Therefore, a <code>Tag</code> that contains only four bytes of data (for a total of 12-bytes on disk including the <code>Tag</code>) would have a <code>size</code> value of <code>1</code>.</p>
<h2><a class="header" href="#xarg-tag----xous-arguments-meta-tag" id="xarg-tag----xous-arguments-meta-tag"><code>XArg</code> tag -- Xous Arguments Meta-Tag</a></h2>
<p>The only ordering requirement for tags is that the first tag should be an <code>XArg</code> tag. This tag indicates the size of the entire structure as well as critical information such as the size of RAM.</p>
<p>Future revisions may add to this tag, however the size will never shrink.</p>
<table><thead><tr><th>Offset</th><th>Size</th><th>Name</th><th>Description</th></tr></thead><tbody>
<tr><td>0</td><td>4</td><td>Arg Size</td><td>The size of the entire args structure, including all headers, but excluding any trailing data (such as executables)</td></tr>
<tr><td>4</td><td>4</td><td>Version</td><td>Version of the XArg structure.  Currently <code>1</code>.</td></tr>
<tr><td>8</td><td>4</td><td>RAM Start</td><td>The origin of system RAM, in bytes</td></tr>
<tr><td>12</td><td>4</td><td>RAM Size</td><td>The size of system RAM, in bytes</td></tr>
<tr><td>16</td><td>4</td><td>RAM Name</td><td>A printable name for system RAM</td></tr>
</tbody></table>
<h3><a class="header" href="#xkrn-tag----xous-kernel-description" id="xkrn-tag----xous-kernel-description"><code>XKrn</code> tag -- Xous Kernel Description</a></h3>
<p>This describes the kernel image.  There must be exactly one <code>XKrn</code> tag in an arguments structure.
This image will get mapped into every process within the final 4 megabytes, and therefore the text and data
offsets must be in the range <code>0xffc0_0000</code> - <code>0xfff0_0000</code>.</p>
<table><thead><tr><th>Offset</th><th>Size</th><th>Name</th><th>Description</th></tr></thead><tbody>
<tr><td>0</td><td>4</td><td>LOAD_OFFSET</td><td>Physical address (or offset) where the kernel is stored</td></tr>
<tr><td>4</td><td>4</td><td>TEXT_OFFSET</td><td>Virtual memory address where the kernel expects the program image to live.  This should be <code>0xffd00000</code>.</td></tr>
<tr><td>8</td><td>4</td><td>TEXT_SIZE</td><td>Size of the text section.  This indicates how many bytes to copy from the boot image.</td></tr>
<tr><td>12</td><td>4</td><td>DATA_OFFSET</td><td>Virtual memory address where the kernel expects the .data/.bss section to be.  This should be above <code>0xffd00000</code> and below  <code>0xffe00000</code></td></tr>
<tr><td>16</td><td>4</td><td>DATA_SIZE</td><td>Size of the .data section</td></tr>
<tr><td>20</td><td>4</td><td>BSS_SIZE</td><td>The size of the .bss section, which immediately follows .data</td></tr>
<tr><td>24</td><td>4</td><td>ENTRYPOINT</td><td>Virtual address of the <code>_start()</code> function</td></tr>
</tbody></table>
<p>The kernel will run in Supervisor mode, and have its own private stack. The address of the stack will be generated by the loader.</p>
<h3><a class="header" href="#inie-tag----initial-elf-programs" id="inie-tag----initial-elf-programs"><code>IniE</code> tag -- Initial ELF Programs</a></h3>
<p>The <code>IniE</code> tag describes how to load initial processes.  There is one <code>IniE</code> for each initial program. There must be at least one <code>IniE</code> tag.</p>
<p>This tag has the following values:</p>
<table><thead><tr><th>Offset</th><th>Size</th><th>Name</th><th>Description</th></tr></thead><tbody>
<tr><td>0</td><td>4</td><td>LOAD_OFFSET</td><td>Position in RAM relative to the start of the arguments  block where this program is stored, or an absolute value if <code>ABSOLUTE</code>  is <code>1</code>.</td></tr>
<tr><td>4</td><td>4</td><td>ENTRYPOINT</td><td>Virtual memory address of the <code>_start()</code> function</td></tr>
</tbody></table>
<p>Following this is a list of <em>section definitions</em>. Section definitions must be sequential in RAM -- that is, it is not permitted for <code>SECTIONn_OFFSET</code> to decrease.
| Offset | Size | Name            | Description                                  |
| ------ | ---- | --------------- | -------------------------------------------- |
| n<em>3+8  | 8    | SECTIONn_OFFSET | Virtual memory address of memory section <em>n</em> |
| n</em>3+12 | 3    | SECTIONn_SIZE   | Size of memory section <em>n</em>                   |
| n*3+15 | 1    | SECTIONn_FLAGS  | Flags describing memory section <em>n</em>          |</p>
<p>The fields <code>size</code>, <code>flags</code>, and <code>offset</code> together occupy 64 bits (8 bytes). The
<code>OFFSET</code> is a full 32-bit address.  The <code>SIZE</code> field is in units of
bytes, however as it is only 24 bits, meaning the largest section size
is <code>2^24</code> bytes.</p>
<p>The <code>FLAGS</code> field contains the following four bits.  Any region may be
marked NOCOPY, however RISC-V does not allow regions to be marked
&quot;Write-only&quot;:</p>
<table><thead><tr><th>Bit</th><th>Binary</th><th>Name</th><th>Description</th></tr></thead><tbody>
<tr><td>0</td><td>0b0001</td><td>NOCOPY</td><td>No data should be copied -- useful for <code>.bss</code></td></tr>
<tr><td>1</td><td>0b0010</td><td>WRITABLE</td><td>Region will be allocated with the &quot;W&quot; bit</td></tr>
<tr><td>2</td><td>0b0100</td><td>READABLE</td><td>Region will be allocated with the &quot;R&quot; bit</td></tr>
<tr><td>3</td><td>0b1000</td><td>EXECUTABLE</td><td>Region will be allocated with the &quot;X&quot; bit</td></tr>
</tbody></table>
<p>Programs <strong>cannot</strong> access the final four megabytes, as this memory
is reserved for the kernel. It is an error if any section enters this memory region.</p>
<h3><a class="header" href="#pnam-tag----program-names" id="pnam-tag----program-names"><code>PNam</code> Tag -- Program Names</a></h3>
<p><code>PNam</code> maps process IDs to process names. If multiple <code>PNam</code> tags exist
within a block, the first one that is encountered should take precedence.
This tag is a series of entries that take the following format:</p>
<table><thead><tr><th>Size (bytes)</th><th>Name</th><th>Description</th></tr></thead><tbody>
<tr><td>4</td><td>PID</td><td>ID of the process that this name describes</td></tr>
<tr><td>4</td><td>Length</td><td>The length of the data that follows</td></tr>
<tr><td>varies</td><td>Data</td><td>The UTF-8 name string</td></tr>
</tbody></table>
<h3><a class="header" href="#bflg-tag----boot-flags" id="bflg-tag----boot-flags"><code>Bflg</code> Tag -- Boot Flags</a></h3>
<p>This configures various bootloader flags.  It consists of a single word
of data with various flags that have the following meaning:</p>
<ul>
<li>0x00000001 <code>NO_COPY</code>  -- Skip copying data to RAM.</li>
<li>0x00000002 <code>ABSOLUTE</code> -- All program addresses are absolute.
Otherwise, they're relative to the start of the config block.</li>
<li>0x00000004 <code>DEBUG</code>    -- Allow the kernel to access memory inside user
programs, which allows a debugger to run in the kernel.</li>
</ul>
<h3><a class="header" href="#mrex-tag----additional-memory-regions" id="mrex-tag----additional-memory-regions"><code>MREx</code> Tag -- Additional Memory Regions</a></h3>
<p>This tag defines additional memory regions beyond main system memory. This region omits main system memory, which is defined in the <code>XArg</code> tag.
The format for this tag consists of a single word defining how many additional sections there are, followed by actual section entries:</p>
<table><thead><tr><th>Offset</th><th>Size</th><th>Name</th><th>Description</th></tr></thead><tbody>
<tr><td>0</td><td>4</td><td>Count</td><td>The number of additional memory entries</td></tr>
</tbody></table>
<p>Each additional memory entry is 3 words of 4-bytes each:</p>
<table><thead><tr><th>Offset</th><th>Size</th><th>Name</th><th>Description</th></tr></thead><tbody>
<tr><td>n*3 + 4</td><td>4</td><td>Start</td><td>The start offset of this additional region</td></tr>
<tr><td>n*3 + 8</td><td>4</td><td>Length</td><td>The length of this additional region</td></tr>
<tr><td>n*3 + 12</td><td>4</td><td>Name</td><td>A 4-character name of this region that should be printable -- useful for debugging</td></tr>
</tbody></table>
<p>Additional memory regions should be non-overlapping. Creating overlapping memory regions will simply waste memory, as the loader will allocate multiple regions to track the memory yet will only allow it to be shared once.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="ch05-00-system-startup.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="ch05-02-loader.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="ch05-00-system-startup.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="ch05-02-loader.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
